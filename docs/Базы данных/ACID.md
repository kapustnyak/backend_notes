### Атомарность (Atomicity)

> [!NOTE] Атомарность
> Либо транзакция будет зафикисирована в базе данных полностью, т.е. будут зафиксированы результаты выполнения всех её операций, либо не будет зафиксирована ни одна из операций
> 
> **Более кратко:**
> “Всё или ничего”: все операции внутри транзакции фиксируются вместе или откатываются целиком.

Если говорить про атомарность в рамках PostgreSQL, то там это реализуют через: BEGIN … COMMIT / ROLLBACK, частичные откаты через SAVEPOINT

**Базовая транзакция**
``` SQL
BEGIN;  -- или START TRANSACTION

-- пример: перевод денег
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;

COMMIT;  -- фиксируем оба апдейта атомарно
-- ROLLBACK;  -- откатили бы всё целиком
```

``` SQL
BEGIN;
INSERT INTO payments (...) VALUES (...);

SAVEPOINT sp1;
-- рискованная часть
INSERT INTO audit_log(...) VALUES (...);

-- при ошибке:
ROLLBACK TO sp1;   -- откатили только risky-часть
COMMIT;
```

### Согласованность (Consistency)

> [!NOTE] Согласованность
> 
> В результате успешного выполнения транзакции база данных была переведена из одного согласованного состояния в другое согласованное состояние.
> 
> **Более кратко:**
> Данные переходят из одного корректного состояния в другое согласно инвариантам: типы, ограничения, триггеры.

В Postgres: NOT NULL, CHECK, UNIQUE, FOREIGN KEY, EXCLUDE, GENERATED, триггеры; можно **отложить проверку** (DEFERRABLE INITIALLY DEFERRED).

****

### Изолированность (Isolation)

> [!NOTE] Изолированность
> Параллельные транзакции не мешают друг другу логически.

В Postgres: уровни изоляции + **MVCC** (snapshot-видимость строк), блокировки строк и **predicate locks** в SERIALIZABLE.

[[Уровни изоляции в SQL]]
### Долговечность (Durability)

> [!NOTE] Долговечность
> После успешной транзакции пользователь должен быть уверен, что данные надежна сохранены в базе данных и впоследствии могут быть извлечены из нее, независимо от возможных сбоев в работе системы.
> 
> **Более кратко:**
> Зафиксированные данные не теряются при сбоях.

В Postgres: **WAL** (журнал предзаписи), fsync, synchronous_commit, репликация.