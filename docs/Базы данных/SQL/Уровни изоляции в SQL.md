### Аномалии при работе с базами данных

**Dirty-read (грязное чтение)** - ситуация, при которой одна транзакция может прочитать изменения другой транзакции, при этом эти изменения ещё не закоммичены. 

> [!NOTE]
> В **PostgreSQL dirty read невозможен**: даже READ UNCOMMITTED трактуется как READ COMMITTED, и MVCC не покажет незакоммиченные версии.
> В других БД, например, MySQL лучше не использовать грязное чтение и READ UNCOMMITED, так как всегда есть риск получить несуществующие данные, если в другой транзации случился ROLLBACK.

**Non-repeatable read** - одна и та же строка читается по-разному в пределах одной транзакции.

| **Уровень**         | **Dirty Read** | **Non-repeatable** | **Phantom** | **Write Skew** | **Примечания**                                                                                           |
| ------------------- | -------------- | ------------------ | ----------- | -------------- | -------------------------------------------------------------------------------------------------------- |
| **READ COMMITTED**  | ✗              | ✔                  | ✔           | ✔              | Быстрый дефолт. Защищайтесь FOR UPDATE/атомарными UPDATE ... SET col = col ± x.                          |
| **REPEATABLE READ** | ✗              | ✗                  | ✗*          | ✔              | Снимок на транзакцию; _в SELECT’ах фантомы не видны, но инварианты всё ещё могут ломаться (write skew)._ |
| **SERIALIZABLE**    | ✗              | ✗                  | ✗           | ✗              | Самый строгий; возможны отмены транзакций → закладываем **retry**.                                       |